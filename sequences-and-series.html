<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whizmath: Unlocking Sequences and Series</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8470165109508371"
     crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Light mode styles */
        .light .bg-gray-100 { background-color: #f3f4f6; }
        .light .text-gray-900 { color: #1f2937; }
        .light .bg-white { background-color: #ffffff; }
        .light .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .light .text-gray-800 { color: #1f2937; }
        .light .text-blue-700 { color: #1d4ed8; }
        .light .bg-blue-600 { background-color: #2563eb; }
        .light .bg-blue-700 { background-color: #1d4ed8; }
        .light .bg-blue-500 { background-color: #3b82f6; }
        .light .from-blue-500 { --tw-gradient-from: #3b82f6; }
        .light .to-indigo-600 { --tw-gradient-to: #4f46e5; }
        .light .bg-gray-50 { background-color: #f9fafb; } /* Card background */
        .light .text-gray-600 { color: #4b5563; } /* Card description text */
        .light .text-gray-700 { color: #374151; } /* Section description text */
        .light .bg-blue-100 { background-color: #dbeafe; } /* Autocomplete hover */
        .light .footer-link-hover:hover { color: #60a5fa; } /* Footer link hover */
        .light .social-icon-bg { background-color: #3b82f6; } /* Social icon background */
        .light .social-icon-bg:hover { background-color: #2563eb; } /* Social icon hover background */
        .light #scroll-to-top-btn { background-color: #2563eb; } /* Scroll to top button */
        .light #scroll-to-top-btn:hover { background-color: #1d4ed8; } /* Scroll to top button hover */


        /* Dark mode styles */
        .dark .bg-gray-100 { background-color: #1a202c; }
        .dark .text-gray-900 { color: #e2e8f0; }
        .dark .bg-white { background-color: #2d3748; } /* Main content section background */
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15); }
        .dark .text-gray-800 { color: #cbd5e0; }
        .dark .text-blue-700 { color: #90cdf4; } /* Section title */
        .dark .bg-blue-600 { background-color: #1a365d; }
        .dark .bg-blue-700 { background-color: #2a4365; }
        .dark .bg-blue-500 { background-color: #3182ce; }
        .dark .from-blue-500 { --tw-gradient-from: #3182ce; }
        .dark .to-indigo-600 { --tw-gradient-to: #5a67d8; }
        .dark .bg-gray-800 { background-color: #1a202c; }
        .dark .text-white { color: #e2e8f0; }
        .dark .bg-gray-50 { background-color: #1f2937; } /* Card background for dark mode */
        .dark .text-gray-600 { color: #a0aec0; } /* Card description text for dark mode */
        .dark .text-gray-700 { color: #cbd5e0; } /* Section description text for dark mode */
        .dark .bg-blue-100 { background-color: #1e3a8a; } /* Autocomplete hover for dark mode */
        .dark .footer-link-hover:hover { color: #60a5fa; } /* Footer link hover */
        .dark .social-icon-bg { background-color: #3182ce; } /* Social icon background */
        .dark .social-icon-bg:hover { background-color: #2b6cb0; } /* Social icon hover background */
        .dark #scroll-to-top-btn { background-color: #3182ce; } /* Scroll to top button */
        .dark #scroll-to-top-btn:hover { background-color: #2b6cb0; } /* Scroll to top button hover */


        /* Ensure smooth transitions for all elements */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        /* Global Three.js Canvas for background animation */
        #global-background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none; /* Allows clicks to pass through to content */
            opacity: 0.7; /* Slightly transparent */
        }

        /* Mobile sidebar styling */
        #mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 256px;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 50;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
        #mobile-menu.open {
            transform: translateX(0);
        }

        /* Overlay for when sidebar is open */
        #mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #mobile-menu-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* Custom Nav Link Hover Effect */
        .nav-link-effect {
            position: relative;
            display: inline-block;
            padding: 8px 12px;
            border-radius: 6px;
            overflow: hidden;
            z-index: 1;
        }

        .nav-link-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.15);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease-out;
            border-radius: 6px;
            z-index: -1;
        }

        .nav-link-effect::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: white;
            transition: width 0.3s ease-out, left 0.3s ease-out;
        }

        .nav-link-effect:hover::before {
            transform: scaleX(1);
        }

        .nav-link-effect:hover::after {
            width: 100%;
            left: 0;
        }

        /* Dark mode specific hover effect adjustments */
        .dark .nav-link-effect::before {
            background-color: rgba(0, 0, 0, 0.2);
        }
        .dark .nav-link-effect::after {
            background-color: #90cdf4; /* Blue-300 for dark mode */
        }

        /* Adjust mobile menu links for the new effect */
        #mobile-menu .nav-link-effect {
            width: 100%;
            text-align: left;
            padding: 12px 16px;
        }

        /* Scroll to Top Button */
        #scroll-to-top-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 4rem;
            height: 4rem;
            border-radius: 9999px; /* Fully rounded */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.3s ease-in-out;
            z-index: 100;
        }

        #scroll-to-top-btn.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Lesson content specific styles */
        .lesson-section {
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .light .lesson-section {
            background-color: #ffffff; /* bg-white */
        }
        .dark .lesson-section {
            background-color: #2d3748; /* dark:bg-gray-700 */
        }
        .lesson-section h3 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            margin-bottom: 1rem;
            color: #1d4ed8; /* text-blue-700 */
        }
        .dark .lesson-section h3 {
            color: #90cdf4; /* dark:text-blue-400 */
        }
        .lesson-section p {
            line-height: 1.75; /* leading-relaxed */
            margin-bottom: 1rem;
            color: #374151; /* text-gray-700 */
        }
        .dark .lesson-section p {
            color: #cbd5e0; /* dark:text-gray-300 */
        }
        .lesson-section ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: #374151;
        }
        .dark .lesson-section ul {
            color: #cbd5e0;
        }
        .lesson-section ul li {
            margin-bottom: 0.5rem;
        }
        .example-box {
            background-color: #e0f2fe; /* bg-blue-50 */
            border-left: 4px solid #3b82f6; /* border-blue-500 */
            padding: 1rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            color: #1d4ed8; /* text-blue-700 */
        }
        .dark .example-box {
            background-color: #1e3a8a; /* dark:bg-blue-900 */
            border-color: #60a5fa; /* dark:border-blue-400 */
            color: #90cdf4; /* dark:text-blue-300 */
        }
        /* Markdown specific styling for equations - keeping from previous version for consistency */
        .lesson-content p code {
            background-color: #e5e7eb; /* Gray-200 */
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            font-family: 'Fira Code', monospace; /* Or any monospaced font */
        }
        html.dark .lesson-content p code {
            background-color: #374151; /* Gray-700 */
        }
        .lesson-content h1, .lesson-content h2, .lesson-content h3, .lesson-content h4 {
            color: #3b82f6; /* Blue-500 */
        }
        html.dark .lesson-content h1, html.dark .lesson-content h2, html.dark .lesson-content h3, html.dark .lesson-content h4 {
            color: #60a5fa; /* Blue-400 */
        }
        .lesson-content strong {
            color: #3b82f6; /* Blue-500 */
        }
        html.dark .lesson-content strong {
            color: #60a5fa; /* Blue-400 */
        }

        /* Basic styling for math formulas */
        .lesson-content .math {
            display: block;
            overflow-x: auto; /* For wide equations */
            padding: 0.5em 0;
            text-align: center;
            font-size: 1.1em;
            color: #1f2937; /* Gray-900 */
        }
        html.dark .lesson-content .math {
            color: #e5e7eb; /* Gray-200 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 flex flex-col min-h-screen">

    <canvas id="global-background-canvas"></canvas>

    <div id="mobile-menu-overlay" class="md:hidden"></div>

    <header class="bg-blue-600 text-white p-4 shadow-md relative z-10">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold rounded-md px-2 py-1">WhizMath</h1>
            <nav class="flex items-center space-x-6 relative">
                <ul class="hidden md:flex space-x-2">
                    <li><a href="index.html" class="nav-link-effect">Home</a></li>
                    <li><a href="tools.html" class="nav-link-effect">Tools</a></li>
                    <li><a href="lessons.html" class="nav-link-effect">Learn</a></li>
                    <li><a href="quizzes.html" class="nav-link-effect">Quizzes</a></li>
                    <li><a href="games.html" class="nav-link-effect">Games</a></li>
                    <li><a href="contact.html" class="nav-link-effect">Contact</a></li>
                </ul>

                <button id="mobile-menu-button" class="md:hidden p-2 rounded-md hover:bg-blue-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>

                <button id="theme-toggle" class="p-2 rounded-full bg-blue-700 hover:bg-blue-800 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 ml-4">
                    <svg id="moon-icon" class="w-6 h-6 text-white transition-all duration-300 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                    <svg id="sun-icon" class="w-6 h-6 text-yellow-300 transition-all duration-300 ease-in-out hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1M4 12H3m15.354 3.354l-.707.707M5.646 5.646l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                </button>
            </nav>
        </div>
    </header>

    <div id="mobile-menu" class="bg-blue-600 text-white p-6 md:hidden">
        <ul class="flex flex-col space-y-4 pt-8">
            <li><a href="index.html" class="nav-link-effect">Home</a></li>
            <li><a href="tools.html" class="nav-link-effect">Tools</a></li>
            <li><a href="lessons.html" class="nav-link-effect">Learn</a></li>
            <li><a href="quizzes.html" class="nav-link-effect">Quizzes</a></li>
            <li><a href="games.html" class="nav-link-effect">Games</a></li>
            <li><a href="contact.html" class="nav-link-effect">Contact</a></li>
        </ul>
    </div>

    <main class="container mx-auto mt-8 p-6 bg-white rounded-lg shadow-lg relative z-10">
        <h2 class="text-4xl font-bold mb-6 text-center text-blue-700 dark:text-blue-400">Unlocking Sequences and Series: Patterns, Sums, and Beyond</h2>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Introduction: The Rhythm of Numbers</h3>
            <p class="mb-4">Welcome to Whizmath, where we reveal the hidden patterns and powerful sums within numbers! Today, we delve into the fascinating world of "Sequences and Series"—two interconnected concepts that describe ordered lists of numbers and their sums. These mathematical tools are not just abstract ideas; they are fundamental to understanding phenomena in finance (compound interest), biology (population growth), computer science (algorithms), and physics (wave patterns).</p>
            <p class="mb-4">In this comprehensive lesson, we will explore the definitions, types, and properties of sequences and series. You'll learn how to identify patterns, calculate specific terms, and find sums of various number progressions. Prepare to discover the elegance of numerical order and the power of infinite sums!</p>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Chapter 1: Sequences – Ordered Lists of Numbers</h3>
            <p class="mb-4">A <strong>sequence</strong> is an ordered list of numbers. Each number in the sequence is called a <strong>term</strong>. We often denote the terms of a sequence as $a_1, a_2, a_3, \dots, a_n, \dots$, where $a_n$ is the $n$-th term.</p>

            <h4 class="text-2xl font-semibold mb-3">1.1 Arithmetic Sequences: Constant Difference</h4>
            <p class="mb-4">An <strong>arithmetic sequence</strong> is a sequence where the difference between consecutive terms is constant. This constant difference is called the <strong>common difference</strong>, denoted by $d$.</p>
            <p class="font-semibold mt-4">General Term (n-th term) of an Arithmetic Sequence:</p>
            <p class="math">$a_n = a_1 + (n-1)d$</p>
            <p class="mb-4">Where:</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li class="mb-2">$a_n$ is the $n$-th term</li>
                <li class="mb-2">$a_1$ is the first term</li>
                <li class="mb-2">$n$ is the term number</li>
                <li class="mb-2">$d$ is the common difference</li>
            </ul>
            <p class="font-semibold mt-4">Example 1.1.1:</p>
            <p>Consider the sequence: $2, 5, 8, 11, \dots$</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>$a_1 = 2$</li>
                <li>Common difference $d = 5 - 2 = 3$ (or $8 - 5 = 3$)</li>
                <li>To find the 10th term ($a_{10}$): $a_{10} = 2 + (10-1)3 = 2 + 9 \times 3 = 2 + 27 = 29$</li>
            </ul>

            <h4 class="text-2xl font-semibold mb-3">1.2 Geometric Sequences: Constant Ratio</h4>
            <p class="mb-4">A <strong>geometric sequence</strong> is a sequence where the ratio between consecutive terms is constant. This constant ratio is called the <strong>common ratio</strong>, denoted by $r$.</p>
            <p class="font-semibold mt-4">General Term (n-th term) of a Geometric Sequence:</p>
            <p class="math">$a_n = a_1 r^{n-1}$</p>
            <p class="mb-4">Where:</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li class="mb-2">$a_n$ is the $n$-th term</li>
                <li class="mb-2">$a_1$ is the first term</li>
                <li class="mb-2">$n$ is the term number</li>
                <li class="mb-2">$r$ is the common ratio</li>
            </ul>
            <p class="font-semibold mt-4">Example 1.2.1:</p>
            <p>Consider the sequence: $3, 6, 12, 24, \dots$</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>$a_1 = 3$</li>
                <li>Common ratio $r = \frac{6}{3} = 2$ (or $\frac{12}{6} = 2$)</li>
                <li>To find the 7th term ($a_7$): $a_7 = 3 \cdot 2^{7-1} = 3 \cdot 2^6 = 3 \cdot 64 = 192$</li>
            </ul>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Chapter 2: Series – The Sum of Sequences</h3>
            <p class="mb-4">A <strong>series</strong> is the sum of the terms of a sequence. If a sequence is $a_1, a_2, a_3, \dots$, then the corresponding series is $a_1 + a_2 + a_3 + \dots$.</p>

            <h4 class="text-2xl font-semibold mb-3">2.1 Finite vs. Infinite Series</h4>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li class="mb-2"><strong>Finite Series:</strong> The sum of a finite number of terms. For example, the sum of the first 5 terms of a sequence.</li>
                <li class="mb-2"><strong>Infinite Series:</strong> The sum of an infinite number of terms. These can either converge (sum to a finite value) or diverge (sum to infinity).</li>
            </ul>

            <h4 class="text-2xl font-semibold mb-3">2.2 Summation Notation ($\Sigma$)</h4>
            <p class="mb-4">We use <strong>summation notation</strong> (or sigma notation) to represent series concisely.</p>
            <p class="math">$\sum_{k=1}^{n} a_k = a_1 + a_2 + a_3 + \dots + a_n$</p>
            <p class="mb-4">Where:</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li class="mb-2">$\Sigma$ (capital sigma) means "sum".</li>
                <li class="mb-2">$k$ is the index of summation (dummy variable).</li>
                <li class="mb-2">$1$ is the lower limit of summation (starting value of $k$).</li>
                <li class="mb-2">$n$ is the upper limit of summation (ending value of $k$).</li>
                <li class="mb-2">$a_k$ is the formula for the $k$-th term.</li>
            </ul>
            <p class="font-semibold mt-4">Example 2.2.1:</p>
            <p>$\sum_{k=1}^{4} (2k + 1) = (2(1)+1) + (2(2)+1) + (2(3)+1) + (2(4)+1)$</p>
            <p class="math">$ = 3 + 5 + 7 + 9 = 24$</p>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Chapter 3: Arithmetic Series – Summing a Constant Difference</h3>
            <p class="mb-4">An <strong>arithmetic series</strong> is the sum of the terms of an arithmetic sequence.</p>

            <h4 class="text-2xl font-semibold mb-3">3.1 Sum of a Finite Arithmetic Series</h4>
            <p class="mb-4">The sum of the first $n$ terms of an arithmetic series, denoted by $S_n$, can be found using two main formulas:</p>
            <p class="font-semibold mt-4">Formula 1 (using first and last term):</p>
            <p class="math">$S_n = \frac{n}{2}(a_1 + a_n)$</p>
            <p class="font-semibold mt-4">Formula 2 (using first term and common difference):</p>
            <p class="math">$S_n = \frac{n}{2}(2a_1 + (n-1)d)$</p>
            <p class="font-semibold mt-4">Example 3.1.1:</p>
            <p>Find the sum of the first 10 terms of the arithmetic sequence: $2, 5, 8, 11, \dots$</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>$a_1 = 2$, $d = 3$, $n = 10$.</li>
                <li>First, find $a_{10}$: $a_{10} = 2 + (10-1)3 = 2 + 27 = 29$.</li>
                <li>Now, use $S_n = \frac{n}{2}(a_1 + a_n)$:</li>
                <li>$S_{10} = \frac{10}{2}(2 + 29) = 5(31) = 155$</li>
            </ul>
            <p class="font-semibold mt-4">Example 3.1.2:</p>
            <p>Find the sum of the first 20 even numbers (starting from 2).</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>This is an arithmetic sequence: $2, 4, 6, \dots$</li>
                <li>$a_1 = 2$, $d = 2$, $n = 20$.</li>
                <li>Using $S_n = \frac{n}{2}(2a_1 + (n-1)d)$:</li>
                <li>$S_{20} = \frac{20}{2}(2(2) + (20-1)2)$</li>
                <li>$S_{20} = 10(4 + 19 \times 2)$</li>
                <li>$S_{20} = 10(4 + 38) = 10(42) = 420$</li>
            </ul>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Chapter 4: Geometric Series – Summing a Constant Ratio</h3>
            <p class="mb-4">A <strong>geometric series</strong> is the sum of the terms of a geometric sequence.</p>

            <h4 class="text-2xl font-semibold mb-3">4.1 Sum of a Finite Geometric Series</h4>
            <p class="mb-4">The sum of the first $n$ terms of a geometric series, denoted by $S_n$, is given by:</p>
            <p class="math">$S_n = \frac{a_1(1 - r^n)}{1 - r}$, where $r \neq 1$</p>
            <p class="font-semibold mt-4">Example 4.1.1:</p>
            <p>Find the sum of the first 6 terms of the geometric sequence: $3, 6, 12, 24, \dots$</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>$a_1 = 3$, $r = 2$, $n = 6$.</li>
                <li>$S_6 = \frac{3(1 - 2^6)}{1 - 2} = \frac{3(1 - 64)}{-1} = \frac{3(-63)}{-1} = 189$</li>
            </ul>

            <h4 class="text-2xl font-semibold mb-3">4.2 Sum of an Infinite Geometric Series</h4>
            <p class="mb-4">An <strong>infinite geometric series</strong> can converge (have a finite sum) only if the absolute value of the common ratio is less than 1 (i.e., $|r| < 1$). If $|r| \geq 1$, the series diverges (its sum approaches infinity or oscillates).</p>
            <p class="font-semibold mt-4">Sum of an Infinite Geometric Series (when $|r| < 1$):</p>
            <p class="math">$S = \frac{a_1}{1 - r}$</p>
            <p class="font-semibold mt-4">Example 4.2.1:</p>
            <p>Find the sum of the infinite geometric series: $1 + \frac{1}{2} + \frac{1}{4} + \frac{1}{8} + \dots$</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>$a_1 = 1$</li>
                <li>$r = \frac{1}{2}$</li>
                <li>Since $|r| = |\frac{1}{2}| < 1$, the series converges.</li>
                <li>$S = \frac{1}{1 - \frac{1}{2}} = \frac{1}{\frac{1}{2}} = 2$</li>
            </ul>
            <p class="font-semibold mt-4">Example 4.2.2:</p>
            <p>Does the series $2 - 4 + 8 - 16 + \dots$ converge or diverge? If it converges, find its sum.</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li>$a_1 = 2$</li>
                <li>$r = \frac{-4}{2} = -2$</li>
                <li>Since $|r| = |-2| = 2 \geq 1$, the series diverges.</li>
            </ul>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Chapter 5: Special Series and Convergence/Divergence</h3>
            <p class="mb-4">Beyond arithmetic and geometric series, there are many other types of series. Determining whether an infinite series converges or diverges is a central topic in calculus.</p>

            <h4 class="text-2xl font-semibold mb-3">5.1 Harmonic Series</h4>
            <p class="mb-4">The <strong>harmonic series</strong> is defined as:</p>
            <p class="math">$\sum_{n=1}^{\infty} \frac{1}{n} = 1 + \frac{1}{2} + \frac{1}{3} + \frac{1}{4} + \dots$</p>
            <p class="mb-4">Despite the terms getting smaller, the harmonic series <strong>diverges</strong> (its sum goes to infinity). This is a classic counter-intuitive result.</p>

            <h4 class="text-2xl font-semibold mb-3">5.2 P-Series</h4>
            <p class="mb-4">A <strong>p-series</strong> is a series of the form:</p>
            <p class="math">$\sum_{n=1}^{\infty} \frac{1}{n^p} = 1 + \frac{1}{2^p} + \frac{1}{3^p} + \frac{1}{4^p} + \dots$</p>
            <p class="mb-4">A p-series converges if $p > 1$ and diverges if $p \leq 1$. The harmonic series is a p-series with $p=1$, which confirms its divergence.</p>

            <h4 class="text-2xl font-semibold mb-3">5.3 Introduction to Convergence Tests (Briefly)</h4>
            <p class="mb-4">For more complex infinite series, various tests are used to determine convergence or divergence without necessarily finding the sum. These tests are typically covered in calculus courses:</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li class="mb-2"><strong>Divergence Test (n-th Term Test):</strong> If $\lim_{n \to \infty} a_n \neq 0$, then the series $\sum a_n$ diverges. (If the limit is 0, the test is inconclusive).</li>
                <li class="mb-2"><strong>Integral Test:</strong> Compares the series to an improper integral.</li>
                <li class="mb-2"><strong>Comparison Tests (Direct and Limit):</strong> Compares the series to a known convergent or divergent series.</li>
                <li class="mb-2"><strong>Ratio Test:</strong> Uses the ratio of consecutive terms, often effective for series involving factorials or exponentials.</li>
                <li class="mb-2"><strong>Root Test:</strong> Uses the $n$-th root of the absolute value of the terms.</li>
                <li class="mb-2"><strong>Alternating Series Test:</strong> For series with alternating signs.</li>
            </ul>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Chapter 6: Real-World Applications of Sequences and Series</h3>
            <p class="mb-4">Sequences and series are powerful mathematical tools with diverse applications:</p>
            <ul class="list-disc list-inside ml-4 mb-4">
                <li><strong>Finance:</strong>
                    <ul class="list-disc list-inside ml-6 mt-1">
                        <li><strong>Compound Interest:</strong> The growth of money with compound interest follows a geometric sequence.</li>
                        <li><strong>Loan Payments/Annuities:</strong> Calculating future values of investments or present values of loans often involves sums of geometric series.</li>
                    </ul>
                </li>
                <li><strong>Population Growth/Decay:</strong> Many models of population change can be described using geometric sequences.</li>
                <li><strong>Physics:</strong>
                    <ul class="list-disc list-inside ml-6 mt-1">
                        <li><strong>Falling Objects:</strong> The distance an object falls in successive seconds forms an arithmetic sequence (ignoring air resistance).</li>
                        <li><strong>Wave Phenomena:</strong> Describing wave patterns and oscillations often involves series (e.g., Fourier series).</li>
                    </ul>
                </li>
                <li><strong>Computer Science:</strong>
                    <ul class="list-disc list-inside ml-6 mt-1">
                        <li><strong>Algorithms:</strong> Analyzing the efficiency of algorithms often involves summing series to determine time complexity.</li>
                        <li><strong>Data Structures:</strong> Understanding how data is stored and accessed can involve sequential thinking.</li>
                    </ul>
                </li>
                <li><strong>Biology:</strong> Modeling bacterial growth, radioactive decay, or drug concentrations in the body.</li>
                <li><strong>Engineering:</strong> Designing structures, analyzing electrical circuits, and signal processing.</li>
                <li><strong>Art and Architecture:</strong> The Fibonacci sequence (a type of recursive sequence) appears in natural patterns and is used in design.</li>
            </ul>
        </section>

        <section class="lesson-section text-center">
            <h3 class="text-3xl font-semibold mb-4">Conclusion: The Endless Possibilities of Patterns</h3>
            <p class="mb-4">You've now explored the fundamental concepts of sequences and series, from identifying simple arithmetic and geometric progressions to understanding their finite and infinite sums. You've seen how these ordered lists and their sums are not merely academic exercises but are deeply embedded in the fabric of the world around us.</p>
            <p class="mb-4">The ability to recognize, analyze, and manipulate sequences and series equips you with powerful tools for problem-solving across various disciplines. Whether you're calculating financial growth, modeling natural phenomena, or optimizing algorithms, the principles you've learned here will prove invaluable.</p>
            <p class="text-xl font-bold text-blue-700 dark:text-blue-400">Keep observing patterns, keep summing possibilities, and keep advancing your mathematical journey with Whizmath!</p>
        </section>

        <section class="lesson-section">
            <h3 class="text-3xl font-semibold mb-4">Practice Problems (with Solutions)</h3>

            <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg mb-6 shadow-md">
                <p class="font-semibold mb-2 text-gray-800 dark:text-gray-200">Problem 1: Arithmetic Sequence Term</p>
                <p class="mb-4 text-gray-700 dark:text-gray-300">Find the 15th term of the arithmetic sequence: $5, 9, 13, \dots$</p>
                <details class="mt-4">
                    <summary class="font-semibold text-blue-700 dark:text-blue-400 cursor-pointer">Show Solution</summary>
                    <div class="mt-2 p-4 bg-white dark:bg-gray-700 rounded-md shadow-inner text-gray-800 dark:text-gray-200">
                        <p class="font-semibold mb-2">Solution 1:</p>
                        <p class="mb-2">$a_1 = 5$, $d = 9 - 5 = 4$, $n = 15$</p>
                        <p class="mb-2">$a_n = a_1 + (n-1)d$</p>
                        <p class="math">$a_{15} = 5 + (15-1)4 = 5 + 14 \times 4 = 5 + 56 = 61$</p>
                    </div>
                </details>
            </div>

            <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg mb-6 shadow-md">
                <p class="font-semibold mb-2 text-gray-800 dark:text-gray-200">Problem 2: Geometric Sequence Term</p>
                <p class="mb-4 text-gray-700 dark:text-gray-300">Find the 6th term of the geometric sequence: $2, 6, 18, \dots$</p>
                <details class="mt-4">
                    <summary class="font-semibold text-blue-700 dark:text-blue-400 cursor-pointer">Show Solution</summary>
                    <div class="mt-2 p-4 bg-white dark:bg-gray-700 rounded-md shadow-inner text-gray-800 dark:text-gray-200">
                        <p class="font-semibold mb-2">Solution 2:</p>
                        <p class="mb-2">$a_1 = 2$, $r = \frac{6}{2} = 3$, $n = 6$</p>
                        <p class="mb-2">$a_n = a_1 r^{n-1}$</p>
                        <p class="math">$a_6 = 2 \cdot 3^{6-1} = 2 \cdot 3^5 = 2 \cdot 243 = 486$</p>
                    </div>
                </details>
            </div>

            <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg mb-6 shadow-md">
                <p class="font-semibold mb-2 text-gray-800 dark:text-gray-200">Problem 3: Sum of Arithmetic Series</p>
                <p class="mb-4 text-gray-700 dark:text-gray-300">Find the sum of the first 12 terms of the arithmetic series with $a_1 = 7$ and $d = 3$.</p>
                <details class="mt-4">
                    <summary class="font-semibold text-blue-700 dark:text-blue-400 cursor-pointer">Show Solution</summary>
                    <div class="mt-2 p-4 bg-white dark:bg-gray-700 rounded-md shadow-inner text-gray-800 dark:text-gray-200">
                        <p class="font-semibold mb-2">Solution 3:</p>
                        <p class="mb-2">$a_1 = 7$, $d = 3$, $n = 12$</p>
                        <p class="mb-2">$S_n = \frac{n}{2}(2a_1 + (n-1)d)$</p>
                        <p class="math">$S_{12} = \frac{12}{2}(2(7) + (12-1)3)$</p>
                        <p class="math">$ = 6(14 + 11 \times 3)$</p>
                        <p class="math">$ = 6(14 + 33) = 6(47) = 282$</p>
                    </div>
                </details>
            </div>

            <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg mb-6 shadow-md">
                <p class="font-semibold mb-2 text-gray-800 dark:text-gray-200">Problem 4: Sum of Finite Geometric Series</p>
                <p class="mb-4 text-gray-700 dark:text-gray-300">Find the sum of the first 5 terms of the geometric series: $4, 8, 16, \dots$</p>
                <details class="mt-4">
                    <summary class="font-semibold text-blue-700 dark:text-blue-400 cursor-pointer">Show Solution</summary>
                    <div class="mt-2 p-4 bg-white dark:bg-gray-700 rounded-md shadow-inner text-gray-800 dark:text-gray-200">
                        <p class="font-semibold mb-2">Solution 4:</p>
                        <p class="mb-2">$a_1 = 4$, $r = \frac{8}{4} = 2$, $n = 5$</p>
                        <p class="mb-2">$S_n = \frac{a_1(1 - r^n)}{1 - r}$</p>
                        <p class="math">$S_5 = \frac{4(1 - 2^5)}{1 - 2} = \frac{4(1 - 32)}{-1} = \frac{4(-31)}{-1} = 124$</p>
                    </div>
                </details>
            </div>

            <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg mb-6 shadow-md">
                <p class="font-semibold mb-2 text-gray-800 dark:text-gray-200">Problem 5: Sum of Infinite Geometric Series</p>
                <p class="mb-4 text-gray-700 dark:text-gray-300">Find the sum of the infinite geometric series: $10 + 5 + 2.5 + 1.25 + \dots$</p>
                <details class="mt-4">
                    <summary class="font-semibold text-blue-700 dark:text-blue-400 cursor-pointer">Show Solution</summary>
                    <div class="mt-2 p-4 bg-white dark:bg-gray-700 rounded-md shadow-inner text-gray-800 dark:text-gray-200">
                        <p class="font-semibold mb-2">Solution 5:</p>
                        <p class="mb-2">$a_1 = 10$, $r = \frac{5}{10} = \frac{1}{2}$</p>
                        <p class="mb-2">Since $|r| = |\frac{1}{2}| < 1$, the series converges.</p>
                        <p class="mb-2">$S = \frac{a_1}{1 - r}$</p>
                        <p class="math">$S = \frac{10}{1 - \frac{1}{2}} = \frac{10}{\frac{1}{2}} = 10 \times 2 = 20$</p>
                    </div>
                </details>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white py-8 mt-auto relative z-10">
        <div class="container mx-auto text-center">
            <p>&copy; 2025 WhizMath. All rights reserved.</p>
            <!--div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="text-white hover:text-blue-200 footer-link-hover">Privacy Policy</a>
                <a href="#" class="text-white hover:text-blue-200 footer-link-hover">Terms of Service</a>
                <a href="#" class="text-white hover:text-blue-200 footer-link-hover">Contact Us</a>
            </div>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="social-icon-bg p-2 rounded-full transform hover:scale-110">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.237 2.636 7.855 6.356 9.314.464.086.66-.2.66-.447 0-.22-.008-.809-.013-1.581-2.56.56-3.1-1.23-3.1-1.23-.418-1.06-.99-1.343-.07-.993.92.062 1.403.957 1.403.957.82 1.403 2.152.997 2.67.765.083-.597.323-.997.593-1.226-2.04-.23-4.183-1.02-4.183-4.523 0-1.002.358-1.823.94-2.462-.095-.23-.41-.1.085-1.29 0 0 .768-.246 2.522.94.72-.2 1.48-.3 2.24-.304.76.004 1.52.104 2.24.304 1.754-1.186 2.522-.94 2.522-.94.495 1.19.18 1.06.085 1.29.582.639.94 1.46.94 2.462 0 3.51-2.146 4.29-4.194 4.516.33.284.626.846.626 1.705 0 1.23-.012 2.219-.012 2.512 0 .249.195.533.663.446C19.364 19.855 22 16.237 22 12c0-5.523-4.477-10-10-10z"></path></svg>
                </a>
                <a href="#" class="social-icon-bg p-2 rounded-full transform hover:scale-110">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.8.35-1.64.59-2.5.66.9-.54 1.5-1.4 1.8-2.4-.84.5-1.78.87-2.78 1.07C18.35 4.5 17.2 4 16 4c-2.48 0-4.5 2.02-4.5 4.5 0 .35.04.68.12 1-.37-.02-.74-.08-1.1-.18-3.08-.15-5.8-1.63-7.68-4.07-.32.55-.5 1.18-.5 1.87 0 1.2.6 2.25 1.58 2.87-.7-.02-1.3-.2-1.8-.5v.05c0 2.18 1.55 4 3.6 4.4-.37.1-.76.15-1.16.15-.28 0-.55-.03-.8-.08.57 1.8 2.2 3.1 4.13 3.4-1.55 1.2-3.5 1.9-5.6 1.9-.36 0-.7-.02-1.04-.06C2.9 20.3 5.3 21 8 21c7.2 0 11.15-5.95 11.15-11.15 0-.17-.0-.33-.01-.5.77-.55 1.45-1.24 1.98-2.02z"></path></svg>
                </a>
                <a href="#" class="social-icon-bg p-2 rounded-full transform hover:scale-110">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.07 1.645.07 4.85s-.012 3.584-.07 4.85c-.148 3.252-1.691 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.07-1.645-.07-4.85s.012-3.584.07-4.85c.148-3.252 1.691-4.771 4.919-4.919 1.266-.058 1.644-.07 4.85-.07zm0 2.163c-3.204 0-3.584.012-4.85.07-2.77.126-3.958 1.46-4.084 4.084-.058 1.265-.07 1.645-.07 4.85s.012 3.584.07 4.85c.126 2.77 1.46 3.958 4.084 4.084 1.265.058 1.645.07 4.85.07s3.584-.012 4.85-.07c2.77-.126 3.958-1.46 4.084-4.084.058-1.265.07-1.645.07-4.85s-.012-3.584-.07-4.85c-.126-2.77-1.46-3.958-4.084-4.084-1.265-.058-1.645-.07-4.85-.07zm0 3.627c-2.481 0-4.5 2.019-4.5 4.5s2.019 4.5 4.5 4.5 4.5-2.019 4.5-4.5-2.019-4.5-4.5-4.5zm0 2.163c1.282 0 2.337 1.055 2.337 2.337s-1.055 2.337-2.337 2.337-2.337-1.055-2.337-2.337 1.055-2.337 2.337-2.337zm6.406-5.463c-.47-.47-.94-.705-1.41-.705s-.94.235-1.41.705c-.47.47-.705.94-.705 1.41s.235.94.705 1.41c.47.47.94.705 1.41.705s.94-.235 1.41-.705c-.47-.47-.705-.94-.705-1.41s-.235-.94-.705-1.41z"></path></svg>
                </a>
        </div-->
        </div>
    </footer>

    <button id="scroll-to-top-btn" class="bg-blue-600">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <script>
        // --- Theme Toggle Logic ---
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        const moonIcon = document.getElementById('moon-icon');
        const sunIcon = document.getElementById('sun-icon');

        // Function to set theme
        function setTheme(theme) {
            if (theme === 'dark') {
                htmlElement.classList.add('dark');
                htmlElement.classList.remove('light');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            } else {
                htmlElement.classList.remove('dark');
                htmlElement.classList.add('light');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
            }
            localStorage.setItem('theme', theme);
            // Removed updateParticleColors call from here. It will be called in window.onload
        }

        // Check for saved theme on load
        const savedTheme = localStorage.getItem('theme') || 'light'; // Default to light
        setTheme(savedTheme);

        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
            // Call updateParticleColors here for immediate visual feedback on theme change
            if (typeof particles !== 'undefined' && particles) {
                updateParticleColors(newTheme === 'dark');
            }
        });

        // --- Mobile Sidebar Menu Logic ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

        function openMobileMenu() {
            mobileMenu.classList.add('open');
            mobileMenuOverlay.classList.add('open');
            document.body.style.overflow = 'hidden'; // Prevent scrolling body when menu is open
        }

        function closeMobileMenu() {
            mobileMenu.classList.remove('open');
            mobileMenuOverlay.classList.remove('open');
            document.body.style.overflow = ''; // Restore body scrolling
        }

        mobileMenuButton.addEventListener('click', () => {
            if (mobileMenu.classList.contains('open')) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        });

        mobileMenuOverlay.addEventListener('click', closeMobileMenu); // Close when clicking overlay

        // Close mobile menu if a link is clicked
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                // Only close if it's a small screen
                if (window.innerWidth < 768) {
                    closeMobileMenu();
                }
            });
        });

        // Handle resize: ensure menu is correct on desktop/mobile switch
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) { // Tailwind's 'md' breakpoint
                closeMobileMenu(); // Ensure sidebar is closed on desktop
            }
        });

        // --- Three.js Global Background Animation Logic ---
        let scene, camera, renderer, particles, particleMaterial;

        function initThreeJS() {
            const canvas = document.getElementById('global-background-canvas');

            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Particles
            const particleCount = 12500;
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);

            // Define colors for light and dark mode for particles
            const lightModeColors = [
                new THREE.Color(0xADD8E6), // Light blue
                new THREE.Color(0x87CEEB), // Sky blue
                new THREE.Color(0x6495ED)  // Cornflower blue
            ];
            const darkModeColors = [
                new THREE.Color(0x3182ce), // Blue-600 dark
                new THREE.Color(0x4299e1), // Blue-500 dark
                new THREE.Color(0x63b3ed)  // Blue-400 dark
            ];

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() * 2 - 1) * 20; // x
                positions[i * 3 + 1] = (Math.random() * 2 - 1) * 20; // y
                positions[i * 3 + 2] = (Math.random() * 2 - 1) * 20; // z

                // Assign initial color based on current theme
                const currentColors = htmlElement.classList.contains('dark') ? darkModeColors : lightModeColors;
                const colorIndex = Math.floor(Math.random() * currentColors.length);
                const color = currentColors[colorIndex];

                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            particleMaterial = new THREE.PointsMaterial({
                size: 0.25,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending,
            });

            particles = new THREE.Points(geometry, particleMaterial);
            scene.add(particles);

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animateThreeJS() {
            requestAnimationFrame(animateThreeJS);

            if (particles) {
                particles.rotation.x += 0.0005;
                particles.rotation.y += 0.0007;
                particles.position.z = Math.sin(Date.now() * 0.0001) * 0.5;
            }

            renderer.render(scene, camera);
        }

        // Function to update particle colors based on theme
        function updateParticleColors(isDarkMode) {
            // Check if particles object is initialized before trying to access its properties
            if (!particles || !particles.geometry || !particles.geometry.attributes.color) {
                console.warn("Three.js particles not yet initialized for color update.");
                return;
            }

            const colors = particles.geometry.attributes.color.array;
            const targetColors = isDarkMode ? [
                new THREE.Color(0x3182ce), // Blue-600 dark
                new THREE.Color(0x4299e1), // Blue-500 dark
                new THREE.Color(0x63b3ed)  // Blue-400 dark
            ] : [
                new THREE.Color(0xADD8E6), // Light blue
                new THREE.Color(0x87CEEB), // Sky blue
                new THREE.Color(0x6495ED)  // Cornflower blue
            ];

            for (let i = 0; i < colors.length; i += 3) {
                const colorIndex = Math.floor(Math.random() * targetColors.length); // Re-randomize color from target palette
                const targetColor = targetColors[colorIndex];
                colors[i] = targetColor.r;
                colors[i + 1] = targetColor.g;
                colors[i + 2] = targetColor.b;
            }
            particles.geometry.attributes.color.needsUpdate = true;
        }


        // --- Scroll to Top Button Logic ---
        const scrollToTopBtn = document.getElementById('scroll-to-top-btn');

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) { // Show button after scrolling 300px
                scrollToTopBtn.classList.add('show');
            } else {
                scrollToTopBtn.classList.remove('show');
            }
        });

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth' // Smooth scroll animation
            });
        });

        window.onload = function() {
            initThreeJS();
            animateThreeJS();
            // Now safely call updateParticleColors after Three.js particles are initialized
            updateParticleColors(htmlElement.classList.contains('dark'));
        };
    </script>
</body>
</html>
